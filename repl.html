<html>
<head>
<style type="text/css">
html, input { font-family: mono; font-size: medium; }
.lisp-repl-input { font-weight: bold; }
.lisp-repl-error { color: red; }
.lisp-repl-log { font-style: italic; }
.lisp-repl-output {  }
</style>
<script type="text/javascript" src="lib/json2.js"></script>
<script type="text/javascript" src="lib/jsparse.js"></script>
<script type="text/javascript" src="lib/biginteger.js"></script>
<script type="text/javascript" src="lib/schemeNumber.js"></script>
<script type="text/javascript" src="lisp.js"></script>
<script type="text/javascript" src="lisp-rt.js"></script>
<script type="text/javascript">
function lisp_print(output)
{
    lisp_repl_insert(output, "lisp-repl-output");
}

function lisp_repl_input(input)
{
    lisp_repl_insert(input, "lisp-repl-input");
}

function lisp_repl_error(msg)
{
    lisp_repl_insert(msg, "lisp-repl-error");
}

function lisp_repl_log(input)
{
    lisp_repl_insert(input, "lisp-repl-log");
}

function lisp_repl_insert(input, className)
{
    var element = document.createElement("div");
    element.className = className;
    element.innerText = input;
    document.getElementById("output").appendChild(element);
}

function lisp_repl()
{
    var input = document.getElementById("input").value
    lisp_repl_input(input);
    try {
      lisp_print(lisp_eval(lisp_read(input)));
      document.getElementById("input").value = "";
    } catch(error) {
      lisp_repl_error(error.message);
    }
    window.scrollTo(0, document.body.scrollHeight);
}

function lisp_load_file(path)
{
    lisp_repl_log("Fetching " + path);
    var req = new XMLHttpRequest();
    req.open("GET", path, false);
    req.send(null);
    lisp_repl_log("Loading " + path);
    if(req.status == 200) {
       lisp_eval(lisp_read(req.responseText));
    } else {
        lisp_error("XHR error", req.status);
    }
}

function lisp_repl_onload()
{
    lisp_load_file("lisp/boot.lisp");
//    lisp_load_file("test/boot-test.lisp");
    lisp_load_file("lisp/http-client.lisp");
    lisp_repl_log("Lisp ready");
    document.getElementById("input").focus();
}
</script>
</head>
<body onload="lisp_repl_onload()">
<div id="output"></div>
<form action="javascript:lisp_repl()">
<input type="text" id="input" value="" style="width: 100%" class="lisp-repl-input">
</form>
</body>
</html>
